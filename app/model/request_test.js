'use strict';

describe('tvGuide.model module', function() {

  var episodeList = [{"id":371875,"url":"http://www.tvmaze.com/episodes/371875/ultimo-a-sair-1x01-gala-1-semana","name":"Gala 1ª Semana","season":1,"number":1,"airdate":"2011-05-08","airtime":"","airstamp":"2011-05-08T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371875"}}},{"id":371876,"url":"http://www.tvmaze.com/episodes/371876/ultimo-a-sair-1x02-gala-2-semana","name":"Gala 2ª Semana","season":1,"number":2,"airdate":"2011-05-15","airtime":"","airstamp":"2011-05-15T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371876"}}},{"id":371877,"url":"http://www.tvmaze.com/episodes/371877/ultimo-a-sair-1x03-nomeacoes-3-semana","name":"Nomeações 3ª Semana","season":1,"number":3,"airdate":"2011-05-17","airtime":"","airstamp":"2011-05-17T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371877"}}},{"id":371878,"url":"http://www.tvmaze.com/episodes/371878/ultimo-a-sair-1x04-gala-3-semana","name":"Gala 3ª Semana","season":1,"number":4,"airdate":"2011-05-22","airtime":"","airstamp":"2011-05-22T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371878"}}},{"id":371879,"url":"http://www.tvmaze.com/episodes/371879/ultimo-a-sair-1x05-nomeacoes-4-semana","name":"Nomeações 4ª Semana","season":1,"number":5,"airdate":"2011-05-24","airtime":"","airstamp":"2011-05-24T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371879"}}},{"id":371880,"url":"http://www.tvmaze.com/episodes/371880/ultimo-a-sair-1x06-gala-4-semana","name":"Gala 4ª Semana","season":1,"number":6,"airdate":"2011-05-29","airtime":"","airstamp":"2011-05-29T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371880"}}},{"id":371881,"url":"http://www.tvmaze.com/episodes/371881/ultimo-a-sair-1x07-nomeacoes-5-semana","name":"Nomeações 5ª Semana","season":1,"number":7,"airdate":"2011-05-31","airtime":"","airstamp":"2011-05-31T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371881"}}},{"id":371882,"url":"http://www.tvmaze.com/episodes/371882/ultimo-a-sair-1x08-gala-5-semana","name":"Gala 5ª Semana","season":1,"number":8,"airdate":"2011-06-04","airtime":"","airstamp":"2011-06-04T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371882"}}},{"id":371883,"url":"http://www.tvmaze.com/episodes/371883/ultimo-a-sair-1x09-nomeacoes-6-semana","name":"Nomeações 6ª Semana","season":1,"number":9,"airdate":"2011-06-07","airtime":"","airstamp":"2011-06-07T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371883"}}},{"id":371884,"url":"http://www.tvmaze.com/episodes/371884/ultimo-a-sair-1x10-gala-6-semana","name":"Gala 6ª Semana","season":1,"number":10,"airdate":"2011-06-12","airtime":"","airstamp":"2011-06-12T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371884"}}},{"id":371885,"url":"http://www.tvmaze.com/episodes/371885/ultimo-a-sair-1x11-nomeacoes-7-semana","name":"Nomeações 7ª Semana","season":1,"number":11,"airdate":"2011-06-14","airtime":"","airstamp":"2011-06-14T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371885"}}},{"id":371886,"url":"http://www.tvmaze.com/episodes/371886/ultimo-a-sair-1x12-gala-7-semana","name":"Gala 7ª Semana","season":1,"number":12,"airdate":"2011-06-19","airtime":"","airstamp":"2011-06-19T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371886"}}},{"id":371887,"url":"http://www.tvmaze.com/episodes/371887/ultimo-a-sair-1x13-nomeacoes-8-semana","name":"Nomeações 8ª Semana","season":1,"number":13,"airdate":"2011-06-21","airtime":"","airstamp":"2011-06-21T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371887"}}},{"id":371888,"url":"http://www.tvmaze.com/episodes/371888/ultimo-a-sair-1x14-gala-8-semana","name":"Gala 8ª Semana","season":1,"number":14,"airdate":"2011-06-26","airtime":"","airstamp":"2011-06-26T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371888"}}},{"id":371889,"url":"http://www.tvmaze.com/episodes/371889/ultimo-a-sair-1x15-nomeacoes-9-semana","name":"Nomeações 9ª Semana","season":1,"number":15,"airdate":"2011-06-28","airtime":"","airstamp":"2011-06-28T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371889"}}},{"id":371890,"url":"http://www.tvmaze.com/episodes/371890/ultimo-a-sair-1x16-gala-9-semana","name":"Gala 9ª Semana","season":1,"number":16,"airdate":"2011-07-03","airtime":"","airstamp":"2011-07-03T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371890"}}},{"id":371891,"url":"http://www.tvmaze.com/episodes/371891/ultimo-a-sair-1x17-nomeacoes-10-semana","name":"Nomeações 10ª Semana","season":1,"number":17,"airdate":"2011-07-05","airtime":"","airstamp":"2011-07-05T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371891"}}},{"id":371892,"url":"http://www.tvmaze.com/episodes/371892/ultimo-a-sair-1x18-gala-10-semana","name":"Gala 10ª Semana","season":1,"number":18,"airdate":"2011-07-10","airtime":"","airstamp":"2011-07-10T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371892"}}},{"id":371893,"url":"http://www.tvmaze.com/episodes/371893/ultimo-a-sair-1x19-nomeacoes-11-semana","name":"Nomeações 11ª Semana","season":1,"number":19,"airdate":"2011-07-12","airtime":"","airstamp":"2011-07-12T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371893"}}},{"id":371894,"url":"http://www.tvmaze.com/episodes/371894/ultimo-a-sair-1x20-gala-11-semana","name":"Gala 11ª Semana","season":1,"number":20,"airdate":"2011-07-17","airtime":"","airstamp":"2011-07-17T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371894"}}},{"id":371895,"url":"http://www.tvmaze.com/episodes/371895/ultimo-a-sair-1x21-entrevistas-12-semana","name":"Entrevistas 12ª Semana","season":1,"number":21,"airdate":"2011-07-19","airtime":"","airstamp":"2011-07-19T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371895"}}},{"id":371896,"url":"http://www.tvmaze.com/episodes/371896/ultimo-a-sair-1x22-gala-12-semana","name":"Gala 12ª Semana","season":1,"number":22,"airdate":"2011-07-24","airtime":"","airstamp":"2011-07-24T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371896"}}},{"id":371897,"url":"http://www.tvmaze.com/episodes/371897/ultimo-a-sair-1x23-entrevistas-13-semana","name":"Entrevistas 13ª Semana","season":1,"number":23,"airdate":"2011-07-26","airtime":"","airstamp":"2011-07-26T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371897"}}},{"id":371898,"url":"http://www.tvmaze.com/episodes/371898/ultimo-a-sair-1x24-gala-13-semana","name":"Gala 13ª Semana","season":1,"number":24,"airdate":"2011-07-31","airtime":"","airstamp":"2011-07-31T00:00:00+01:00","runtime":60,"image":null,"summary":"","_links":{"self":{"href":"http://api.tvmaze.com/episodes/371898"}}}];

  var shows_a = [{"score":1.0172879,"show":{"id":6258,"url":"http://www.tvmaze.com/shows/6258/ultimo-a-sair","name":"Último a Sair","type":"Scripted","language":"Portuguese","genres":[],"status":"Ended","runtime":60,"premiered":"2011-05-08","schedule":{"time":"","days":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]},"rating":{"average":null},"weight":0,"network":{"id":102,"name":"RTP","country":{"name":"Portugal","code":"PT","timezone":"Europe/Lisbon"}},"webChannel":null,"externals":{"tvrage":28351,"thetvdb":255071},"image":{"medium":"http://tvmazecdn.com/uploads/images/medium_portrait/24/60041.jpg","original":"http://tvmazecdn.com/uploads/images/original_untouched/24/60041.jpg"},"summary":"","updated":1444671861,"_links":{"self":{"href":"http://api.tvmaze.com/shows/6258"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/371898"}}}},{"score":0.97267133,"show":{"id":1197,"url":"http://www.tvmaze.com/shows/1197/a-haunting","name":"A Haunting","type":"Documentary","language":"English","genres":["Drama","Horror","Thriller","Mystery"],"status":"Running","runtime":60,"premiered":"2005-10-28","schedule":{"time":"22:00","days":["Sunday"]},"rating":{"average":null},"weight":2,"network":{"id":107,"name":"Destination America","country":{"name":"United States","code":"US","timezone":"America/New_York"}},"webChannel":null,"externals":{"tvrage":13319,"thetvdb":79535,"imdb":"tt0484243"},"image":{"medium":"http://tvmazecdn.com/uploads/images/medium_portrait/7/17535.jpg","original":"http://tvmazecdn.com/uploads/images/original_untouched/7/17535.jpg"},"summary":"<p> \"When the door between the spirit world and ours is opened, the stuff of nightmares becomes reality\". That's according to the introduction of this series <strong><em>\"A Haunting\"</em></strong> which dramatizes the \"true\" stories of people who have been haunted or experienced a haunting. In this docu-drama, the actual people involved recount their stories on-camera, as the frightening events of their stories are re-enacted....<br /><br />First quote in opening of show<br />\"Between the world we see and the things we fear, there are doors. When they are opened, nightmares become reality.\"</p>","updated":1452988402,"_links":{"self":{"href":"http://api.tvmaze.com/shows/1197"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/557403"},"nextepisode":{"href":"http://api.tvmaze.com/episodes/566352"}}}},{"score":0.96607465,"show":{"id":11320,"url":"http://www.tvmaze.com/shows/11320/a-dal","name":"A Dal","type":"Scripted","language":"Hungarian","genres":[],"status":"Running","runtime":120,"premiered":"2012-01-28","schedule":{"time":"20:20","days":["Saturday"]},"rating":{"average":null},"weight":5,"network":{"id":413,"name":"Duna TV","country":{"name":"Hungary","code":"HU","timezone":"Europe/Budapest"}},"webChannel":null,"externals":{"tvrage":null,"thetvdb":null},"image":{"medium":"http://tvmazecdn.com/uploads/images/medium_portrait/38/95627.jpg","original":"http://tvmazecdn.com/uploads/images/original_untouched/38/95627.jpg"},"summary":"","updated":1452458327,"_links":{"self":{"href":"http://api.tvmaze.com/shows/11320"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/560897"},"nextepisode":{"href":"http://api.tvmaze.com/episodes/560898"}}}},{"score":0.96595424,"show":{"id":1697,"url":"http://www.tvmaze.com/shows/1697/cuestion-de-sexo","name":"Cuestión de Sexo","type":"Scripted","language":null,"genres":["Comedy"],"status":"Ended","runtime":null,"premiered":"2007-09-25","schedule":{"time":"","days":[]},"rating":{"average":null},"weight":0,"network":{"id":98,"name":"Cuatro","country":{"name":"Spain","code":"ES","timezone":"Europe/Madrid"}},"webChannel":null,"externals":{"tvrage":null,"thetvdb":81754},"image":{"medium":"http://tvmazecdn.com/uploads/images/medium_portrait/9/23883.jpg","original":"http://tvmazecdn.com/uploads/images/original_untouched/9/23883.jpg"},"summary":"","updated":1431030250,"_links":{"self":{"href":"http://api.tvmaze.com/shows/1697"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/145554"}}}},{"score":0.96595424,"show":{"id":11431,"url":"http://www.tvmaze.com/shows/11431/hij-is-een-zij","name":"Hij is een Zij","type":"Documentary","language":"Dutch","genres":[],"status":"Running","runtime":40,"premiered":"2014-01-07","schedule":{"time":"21:20","days":["Tuesday"]},"rating":{"average":null},"weight":1,"network":{"id":784,"name":"KRO-NCVR","country":{"name":"Netherlands","code":"NL","timezone":"Europe/Amsterdam"}},"webChannel":null,"externals":{"tvrage":null,"thetvdb":305791},"image":{"medium":"http://tvmazecdn.com/uploads/images/medium_portrait/38/96560.jpg","original":"http://tvmazecdn.com/uploads/images/original_untouched/38/96560.jpg"},"summary":"<p>Arie Boomsma follows six young people during their transformation from man to female or the other way around. <strong><em>Hij is een Zij </em></strong>follows those younger ones for more than a year to give viewers a better insight from what they experience</p>","updated":1452452167,"_links":{"self":{"href":"http://api.tvmaze.com/shows/11431"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/564497"},"nextepisode":{"href":"http://api.tvmaze.com/episodes/564498"}}}},{"score":0.96595424,"show":{"id":5900,"url":"http://www.tvmaze.com/shows/5900/un-village-francais","name":"Un village français","type":"Scripted","language":"French","genres":[],"status":"Running","runtime":55,"premiered":"2009-06-04","schedule":{"time":"20:35","days":["Thursday"]},"rating":{"average":null},"weight":0,"network":{"id":249,"name":"France 3","country":{"name":"France","code":"FR","timezone":"Europe/Paris"}},"webChannel":null,"externals":{"tvrage":28293,"thetvdb":211941},"image":{"medium":"http://tvmazecdn.com/uploads/images/medium_portrait/23/58375.jpg","original":"http://tvmazecdn.com/uploads/images/original_untouched/23/58375.jpg"},"summary":"","updated":1448715664,"_links":{"self":{"href":"http://api.tvmaze.com/shows/5900"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/497605"}}}},{"score":0.96595424,"show":{"id":7637,"url":"http://www.tvmaze.com/shows/7637/its-a-living","name":"It's a Living","type":"Scripted","language":"English","genres":["Comedy"],"status":"Ended","runtime":30,"premiered":"1980-10-30","schedule":{"time":"21:00","days":["Saturday"]},"rating":{"average":null},"weight":0,"network":{"id":72,"name":"Syndication","country":{"name":"United States","code":"US","timezone":"America/New_York"}},"webChannel":null,"externals":{"tvrage":36,"thetvdb":77103},"image":{"medium":"http://tvmazecdn.com/uploads/images/medium_portrait/28/70365.jpg","original":"http://tvmazecdn.com/uploads/images/original_untouched/28/70365.jpg"},"summary":"<p><strong><em>\"It's a Living\"</em></strong> takes place at a posh restaurant, Above the Top which is located on the top floor of a California high rise hotel. This series originally began in October of 1980 on ABC and ran for one season. ABC must have had faith in the show for it returned the following season under a new title, Making a Living. After that everyone thought they had seen the last of it, but in 1985, It's a Living restarted production for an additional four seasons which ran in syndication. The stories revolved around the waitresses (who've included: Lois, Jan, Dot, Cassie, Vicki, Maggie, Amy and Ginger) their boss and hostess, Nancy, and the piano man Sonny.</p>","updated":1452893797,"_links":{"self":{"href":"http://api.tvmaze.com/shows/7637"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/430434"}}}},{"score":0.96497214,"show":{"id":11402,"url":"http://www.tvmaze.com/shows/11402/the-a-word","name":"The A Word","type":"Scripted","language":null,"genres":[],"status":"In Development","runtime":60,"premiered":null,"schedule":{"time":"","days":[]},"rating":{"average":null},"weight":1,"network":{"id":12,"name":"BBC One","country":{"name":"United Kingdom","code":"GB","timezone":"Europe/London"}},"webChannel":null,"externals":{"tvrage":null,"thetvdb":null},"image":null,"summary":"<p>The series, which today announces its stellar line up - Christopher \nEccleston (The Leftovers, Fortitude), Lee Ingleby (Our Zoo), Morven \nChristie (Grantchester), Greg McHugh (Fresh Meat), Vinette Robinson \n(Sherlock) and newcomer, six-year-old Max Vento - is the story of the \nHughes family, who work and love and fight like every other family. Then\n their youngest son is diagnosed with autism and they don't feel like \nevery other family anymore. They realise that if their son is ever going\n to communicate, they are going to have to learn how to communicate \nthemselves. It's a funny and thought-provoking series about parenthood \nand childhood.</p>","updated":1452348267,"_links":{"self":{"href":"http://api.tvmaze.com/shows/11402"}}}},{"score":0.96442056,"show":{"id":11369,"url":"http://www.tvmaze.com/shows/11369/a-kod","name":"A kód","type":"Game Show","language":"Hungarian","genres":[],"status":"Ended","runtime":45,"premiered":"2012-11-05","schedule":{"time":"19:00","days":["Monday","Tuesday","Wednesday","Thursday","Friday"]},"rating":{"average":null},"weight":5,"network":{"id":426,"name":"RTL Klub","country":{"name":"Hungary","code":"HU","timezone":"Europe/Budapest"}},"webChannel":null,"externals":{"tvrage":null,"thetvdb":null},"image":{"medium":"http://tvmazecdn.com/uploads/images/medium_portrait/38/95975.jpg","original":"http://tvmazecdn.com/uploads/images/original_untouched/38/95975.jpg"},"summary":"","updated":1452347961,"_links":{"self":{"href":"http://api.tvmaze.com/shows/11369"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/563906"}}}},{"score":0.96304065,"show":{"id":4325,"url":"http://www.tvmaze.com/shows/4325/the-a-team","name":"The A-Team","type":"Scripted","language":"English","genres":["Drama","Action","Crime"],"status":"In Development","runtime":60,"premiered":null,"schedule":{"time":"","days":[]},"rating":{"average":null},"weight":0,"network":{"id":1,"name":"NBC","country":{"name":"United States","code":"US","timezone":"America/New_York"}},"webChannel":null,"externals":{"tvrage":null,"thetvdb":null},"image":null,"summary":"<p>Like the original NBC show, <strong><em>\"The </em></strong><em><strong>A-Team\"</strong></em> revolves around a diverse team of American Special Forces operatives. Unlike the original all-male squad, the new team will include both male and female members. The group has been framed for a crime they didn't commit and set out to clear their names by uncovering the black-ops conspiracy that set them up. Along the way, they are driven to help those in need by using their singular military skills, high-tech expertise and often conflicting individual approaches. It's described as a fun episodic mission-of-the-week show that mixes big action-adventure sequences with compelling characters, inventive cons and lots of humor.</p>","updated":1443698682,"_links":{"self":{"href":"http://api.tvmaze.com/shows/4325"}}}}];

  beforeEach(angular.mock.module('tvGuide.model'));

  describe('req service', function(){

  	var req = {};
  	var $httpBackend;
  	beforeEach(angular.mock.inject(function(_req_, _$httpBackend_) {
  		req = _req_;
  		$httpBackend = _$httpBackend_;
  	}))

  	it('should get episodes for show ID 6258', function() {
  		var response;

  		$httpBackend.when('GET', 'http://api.tvmaze.com/shows/6258/episodes')
  			.respond(200, episodeList);

  		req.getEpisodes(6258)
  			.then(function(data) {
  				response = data;
  			})

  		$httpBackend.flush();
  		expect(response).toEqual(episodeList);
  	})

  	it('should get episodes for show ID 6258 and handle error', function() {
  		var response;

  		$httpBackend.when('GET', 'http://api.tvmaze.com/shows/6258/episodes')
  			.respond(500);

  		req.getEpisodes(6258)
  			.then(function(data) {
  				response = data;
  			})
  			.catch(function() {
  				response = 'Error';
  			})

  		$httpBackend.flush();
  		expect(response).toEqual('Error');
  	})

  	it('should get matching shows for a', function() {
  		var response;

  		$httpBackend.expect('GET', 'http://api.tvmaze.com/search/shows?q=a')
  			.respond(200, shows_a);

  		req.searchShow('a')
  			.then(function(data) {
  				response = data;
  			})

  		$httpBackend.flush();
  		expect(response).toEqual(shows_a);
  	})

  	it('should get matching shows for a and handle error', function() {
  		var response;

  		$httpBackend.expect('GET', 'http://api.tvmaze.com/search/shows?q=a')
  			.respond(500);

  		req.searchShow('a')
  			.then(function(data) {
  				response = data;
  			})
  			.catch(function() {
  				response = 'Error';
  			})

  		$httpBackend.flush();
  		expect(response).toEqual('Error');
  	})

  });
});